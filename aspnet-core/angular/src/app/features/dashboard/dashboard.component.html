<div class="dashboard-container" [dir]="isRTL ? 'rtl' : 'ltr'">
  <!-- Header -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">
      <i class="fas fa-chart-line"></i>
      لوحة التحكم
    </h1>
    <p class="dashboard-subtitle">مرحباً بكم في منصة الامتثال للحوكمة والمخاطر</p>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">جاري التحميل...</span>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && overview" class="dashboard-content">
    
    <!-- Statistics Cards -->
    <div class="row stats-cards">
      <!-- Active Assessments -->
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-card card-primary">
          <div class="stat-icon">
            <i class="fas fa-tasks"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-number">{{ overview.activeAssessments }}</h3>
            <p class="stat-label">التقييمات النشطة</p>
          </div>
        </div>
      </div>

      <!-- Total Controls -->
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-card card-info">
          <div class="stat-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-number">{{ overview.totalControls }}</h3>
            <p class="stat-label">إجمالي الضوابط</p>
          </div>
        </div>
      </div>

      <!-- Completed Controls -->
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-card card-success">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-number">{{ overview.completedControls }}</h3>
            <p class="stat-label">الضوابط المكتملة</p>
            <div class="progress-bar-mini">
              <div class="progress-fill" [style.width.%]="getProgressPercentage(overview.completedControls, overview.totalControls)"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Overdue Controls -->
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-card card-danger">
          <div class="stat-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-number">{{ overview.overdueControls }}</h3>
            <p class="stat-label">الضوابط المتأخرة</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Compliance Score and Framework Progress -->
    <div class="row mt-4">
      <!-- Compliance Score -->
      <div class="col-lg-4 mb-4">
        <div class="card score-card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-chart-pie"></i>
              مستوى الامتثال
            </h5>
          </div>
          <div class="card-body text-center">
            <div class="compliance-circle">
              <svg viewBox="0 0 200 200">
                <circle cx="100" cy="100" r="90" fill="none" stroke="#e9ecef" stroke-width="20"/>
                <circle 
                  cx="100" 
                  cy="100" 
                  r="90" 
                  fill="none" 
                  [attr.stroke]="overview.averageScore >= 80 ? '#28a745' : overview.averageScore >= 60 ? '#ffc107' : '#dc3545'"
                  stroke-width="20"
                  [attr.stroke-dasharray]="565.48"
                  [attr.stroke-dashoffset]="565.48 - (565.48 * overview.averageScore / 100)"
                  transform="rotate(-90 100 100)"
                  stroke-linecap="round"/>
              </svg>
              <div class="score-text">
                <h2>{{ overview.averageScore | number:'1.0-1' }}%</h2>
                <p class="badge" [class.badge-success]="overview.averageScore >= 80" 
                   [class.badge-warning]="overview.averageScore >= 60 && overview.averageScore < 80"
                   [class.badge-danger]="overview.averageScore < 60">
                  {{ overview.complianceLevel }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Framework Progress -->
      <div class="col-lg-8 mb-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-project-diagram"></i>
              التقدم حسب الإطار
            </h5>
          </div>
          <div class="card-body">
            <div *ngFor="let framework of frameworkProgress" class="framework-item">
              <div class="framework-header">
                <span class="framework-name">{{ framework.frameworkName }}</span>
                <span class="framework-percentage">{{ framework.compliancePercentage }}%</span>
              </div>
              <div class="progress framework-progress">
                <div class="progress-bar bg-success" 
                     [style.width.%]="(framework.completedControls / framework.totalControls) * 100"
                     [attr.title]="'مكتمل: ' + framework.completedControls"></div>
                <div class="progress-bar bg-warning" 
                     [style.width.%]="(framework.inProgressControls / framework.totalControls) * 100"
                     [attr.title]="'قيد التنفيذ: ' + framework.inProgressControls"></div>
                <div class="progress-bar bg-secondary" 
                     [style.width.%]="(framework.notStartedControls / framework.totalControls) * 100"
                     [attr.title]="'لم يبدأ: ' + framework.notStartedControls"></div>
              </div>
              <div class="framework-legend">
                <span class="legend-item">
                  <span class="legend-color bg-success"></span>
                  مكتمل ({{ framework.completedControls }})
                </span>
                <span class="legend-item">
                  <span class="legend-color bg-warning"></span>
                  قيد التنفيذ ({{ framework.inProgressControls }})
                </span>
                <span class="legend-item">
                  <span class="legend-color bg-secondary"></span>
                  لم يبدأ ({{ framework.notStartedControls }})
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- My Controls and Upcoming Deadlines -->
    <div class="row mt-4">
      <!-- My Controls -->
      <div class="col-lg-8 mb-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-user-check"></i>
              الضوابط المسندة إليّ
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>الضابط</th>
                    <th>الإطار</th>
                    <th>الحالة</th>
                    <th>تاريخ الاستحقاق</th>
                    <th>الإجراءات</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let control of myControls">
                    <td>
                      <strong>{{ control.controlName }}</strong>
                    </td>
                    <td>
                      <span class="badge badge-secondary">{{ control.frameworkName }}</span>
                    </td>
                    <td>
                      <span class="badge" [class]="'badge-' + getStatusColor(control.status)">
                        {{ control.status }}
                      </span>
                    </td>
                    <td>
                      <i class="fas fa-calendar-alt"></i>
                      {{ formatDate(control.dueDate) }}
                    </td>
                    <td>
                      <button class="btn btn-sm btn-primary" title="عرض التفاصيل">
                        <i class="fas fa-eye"></i>
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="myControls.length === 0">
                    <td colspan="5" class="text-center text-muted">
                      <i class="fas fa-inbox"></i>
                      لا توجد ضوابط مسندة
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Deadlines -->
      <div class="col-lg-4 mb-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-clock"></i>
              المواعيد النهائية القادمة
            </h5>
          </div>
          <div class="card-body">
            <div class="deadline-list">
              <div *ngFor="let deadline of overview.upcomingDeadlines" class="deadline-item">
                <div class="deadline-icon">
                  <i class="fas fa-calendar-check" 
                     [class.text-danger]="deadline.daysRemaining <= 3"
                     [class.text-warning]="deadline.daysRemaining > 3 && deadline.daysRemaining <= 7"
                     [class.text-info]="deadline.daysRemaining > 7"></i>
                </div>
                <div class="deadline-content">
                  <h6 class="deadline-name">{{ deadline.name }}</h6>
                  <p class="deadline-date">
                    <small>{{ formatDate(deadline.dueDate) }}</small>
                    <span class="deadline-remaining" 
                          [class.text-danger]="deadline.daysRemaining <= 3"
                          [class.text-warning]="deadline.daysRemaining > 3 && deadline.daysRemaining <= 7">
                      {{ getDaysRemainingText(deadline.daysRemaining) }}
                    </span>
                  </p>
                </div>
              </div>
              <div *ngIf="overview.upcomingDeadlines.length === 0" class="text-center text-muted py-3">
                <i class="fas fa-check-circle"></i>
                <p>لا توجد مواعيد نهائية قادمة</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

