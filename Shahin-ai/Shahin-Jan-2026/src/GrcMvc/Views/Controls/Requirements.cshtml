@{
    ViewData["Title"] = "Requirements Manager - Shahin MAP";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="h3">
                <i class="fas fa-file-alt text-primary"></i> Requirements Manager
                <small class="text-muted fs-6">Shahin MAP</small>
            </h1>
            <p class="text-muted">Import and manage regulatory requirements from frameworks</p>
        </div>
        <div class="col-md-4 text-end">
            <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#importModal">
                <i class="fas fa-upload"></i> Import
            </button>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRequirementModal">
                <i class="fas fa-plus"></i> Add Requirement
            </button>
        </div>
    </div>

    <!-- Framework Tabs -->
    <ul class="nav nav-tabs mb-4" id="frameworkTabs">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#all">All Requirements</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#nca-ecc">NCA ECC (109)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#sama">SAMA CSF (87)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#pdpl">PDPL (42)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#nca-cscc">NCA CSCC (50)</a>
        </li>
    </ul>

    <!-- Requirements Table -->
    <div class="card shadow">
        <div class="card-header bg-white">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="searchReq" placeholder="Search requirements..." onkeyup="filterRequirements()">
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterCategory" onchange="filterRequirements()">
                        <option value="">All Categories</option>
                        <option value="Technical">Technical</option>
                        <option value="Administrative">Administrative</option>
                        <option value="Physical">Physical</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterPriority" onchange="filterRequirements()">
                        <option value="">All Priorities</option>
                        <option value="Critical">Critical</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div class="col-md-2 text-end">
                    <span class="badge bg-primary" id="reqCount">288</span> requirements
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 100px;">Req ID</th>
                            <th>Requirement Text</th>
                            <th style="width: 120px;">Framework</th>
                            <th style="width: 100px;">Category</th>
                            <th style="width: 80px;">Priority</th>
                            <th style="width: 100px;">Mapped</th>
                            <th style="width: 80px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reqTableBody">
                        <tr>
                            <td><code>ECC-1.1.1</code></td>
                            <td>The organization shall develop and maintain a cybersecurity strategy aligned with business objectives</td>
                            <td><span class="badge bg-info">NCA ECC</span></td>
                            <td>Administrative</td>
                            <td><span class="badge bg-danger">Critical</span></td>
                            <td><span class="badge bg-success">3 controls</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewMapping('ECC-1.1.1')">
                                    <i class="fas fa-link"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><code>ECC-1.1.2</code></td>
                            <td>Cybersecurity governance structure shall be established with clear roles and responsibilities</td>
                            <td><span class="badge bg-info">NCA ECC</span></td>
                            <td>Administrative</td>
                            <td><span class="badge bg-danger">Critical</span></td>
                            <td><span class="badge bg-success">2 controls</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewMapping('ECC-1.1.2')">
                                    <i class="fas fa-link"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><code>SAMA-1.1</code></td>
                            <td>Financial institutions shall implement a cybersecurity program approved by the board</td>
                            <td><span class="badge bg-warning text-dark">SAMA CSF</span></td>
                            <td>Administrative</td>
                            <td><span class="badge bg-danger">Critical</span></td>
                            <td><span class="badge bg-success">4 controls</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewMapping('SAMA-1.1')">
                                    <i class="fas fa-link"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><code>PDPL-5</code></td>
                            <td>Personal data processing requires explicit consent from the data subject</td>
                            <td><span class="badge bg-success">PDPL</span></td>
                            <td>Administrative</td>
                            <td><span class="badge bg-warning text-dark">High</span></td>
                            <td><span class="badge bg-secondary">Not mapped</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="createMapping('PDPL-5')">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-upload"></i> Import Requirements</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Select Framework</label>
                    <select class="form-select">
                        <option>NCA ECC 2:2024</option>
                        <option>SAMA CSF</option>
                        <option>PDPL</option>
                        <option>NCA CSCC</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Upload File (CSV/Excel)</label>
                    <input type="file" class="form-control" accept=".csv,.xlsx">
                </div>
                <div class="alert alert-info small">
                    <i class="fas fa-info-circle"></i> Expected columns: ReqID, Text, Category, Priority
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Import
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    function filterRequirements() {
        // Filter implementation
    }

    function viewMapping(reqId) {
        window.location.href = '/Controls/Mapping?reqId=' + reqId;
    }

    function createMapping(reqId) {
        window.location.href = '/Controls/Mapping?reqId=' + reqId + '&action=create';
    }
</script>
