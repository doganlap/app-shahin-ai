@using Microsoft.AspNetCore.Mvc.Localization
@inject IHtmlLocalizer<SharedResource> L
@model IEnumerable<dynamic>
@{
    ViewData["Title"] = "Program Initiatives";
    Layout = "_Layout";

    var programId = ViewBag.ProgramId as int? ?? 0;
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-list-check"></i> @L["ProgramInitiatives"]</h2>
            <p class="text-muted">@L["TrackAndManageInitiativesWithinGRCPrograms"]</p>
        </div>
        <div class="col text-end">
            <a asp-action="Definition" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> @L["BackToPrograms"]
            </a>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInitiativeModal">
                <i class="bi bi-plus-circle"></i> @L["AddInitiative"]
            </button>
        </div>
    </div>

    <!-- Initiative Summary -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white shadow-sm">
                <div class="card-body text-center">
                    <h6 class="opacity-75">@L["TotalInitiatives"]</h6>
                    <h2 class="mb-0">23</h2>
                    <small>@L["AcrossAllPrograms"]</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white shadow-sm">
                <div class="card-body text-center">
                    <h6 class="opacity-75">@L["InProgress"]</h6>
                    <h2 class="mb-0">15</h2>
                    <small>@L["ActivelyBeingWorked"]</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white shadow-sm">
                <div class="card-body text-center">
                    <h6 class="opacity-75">@L["Completed"]</h6>
                    <h2 class="mb-0">6</h2>
                    <small>@L["FinishedThisQuarter"]</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark shadow-sm">
                <div class="card-body text-center">
                    <h6>@L["Pending"]</h6>
                    <h2 class="mb-0">2</h2>
                    <small>@L["AwaitingApproval"]</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="row align-items-end">
                        <div class="col-md-3">
                            <label class="form-label small">@L["Program"]</label>
                            <select class="form-select form-select-sm">
                                <option value="">@L["AllPrograms"]</option>
                                <option selected>ISO 27001 Certification</option>
                                <option>Risk Management Enhancement</option>
                                <option>Compliance Automation</option>
                                <option>Business Continuity</option>
                                <option>Maturity Excellence</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">@L["Status"]</label>
                            <select class="form-select form-select-sm">
                                <option value="">@L["AllStatuses"]</option>
                                <option>@L["Pending"]</option>
                                <option>@L["InProgress"]</option>
                                <option>@L["Completed"]</option>
                                <option>@L["OnHold"]</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">@L["Priority"]</label>
                            <select class="form-select form-select-sm">
                                <option value="">@L["AllPriorities"]</option>
                                <option>@L["Critical"]</option>
                                <option>@L["High"]</option>
                                <option>@L["Medium"]</option>
                                <option>@L["Low"]</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-sm btn-primary w-100">
                                <i class="bi bi-search"></i> @L["Filter"]
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Initiatives Table -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-kanban"></i> @L["InitiativesList"]</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>@L["Initiative"]</th>
                                    <th>@L["Program"]</th>
                                    <th>@L["Owner"]</th>
                                    <th>@L["Priority"]</th>
                                    <th>@L["DueDate"]</th>
                                    <th>@L["Progress"]</th>
                                    <th>@L["Status"]</th>
                                    <th>@L["Actions"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <strong>Gap Analysis Completion</strong>
                                        <br /><small class="text-muted">@L["Identify"] ISO 27001 compliance gaps</small>
                                    </td>
                                    <td><span class="badge bg-primary">ISO 27001</span></td>
                                    <td>Sarah Johnson</td>
                                    <td><span class="badge bg-danger">@L["Critical"]</span></td>
                                    <td>Jan 31, 2026</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-success" style="width: 95%">95%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-success">@L["InProgress"]</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>ISMS Documentation</strong>
                                        <br /><small class="text-muted">@L["CreateSecurityPolicies"]</small>
                                    </td>
                                    <td><span class="badge bg-primary">ISO 27001</span></td>
                                    <td>Mark Davis</td>
                                    <td><span class="badge bg-danger">@L["Critical"]</span></td>
                                    <td>Feb 15, 2026</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-warning" style="width: 60%">60%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-success">@L["InProgress"]</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Risk Register Update</strong>
                                        <br /><small class="text-muted">@L["Comprehensive"] risk assessment</small>
                                    </td>
                                    <td><span class="badge bg-info">Risk Mgmt</span></td>
                                    <td>Michael Chen</td>
                                    <td><span class="badge bg-warning text-dark">@L["High"]</span></td>
                                    <td>Jan 25, 2026</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-info" style="width: 75%">75%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-success">@L["InProgress"]</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Automated Control Testing</strong>
                                        <br /><small class="text-muted">@L["ImplementAutomationFramework"]</small>
                                    </td>
                                    <td><span class="badge bg-secondary">Compliance</span></td>
                                    <td>Emily Rodriguez</td>
                                    <td><span class="badge bg-warning text-dark">@L["High"]</span></td>
                                    <td>Feb 28, 2026</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-warning" style="width: 40%">40%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-warning text-dark">@L["AtRisk"]</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>BCP/DR Testing</strong>
                                        <br /><small class="text-muted">@L["QuarterlyDrillExecution"]</small>
                                    </td>
                                    <td><span class="badge bg-success">BC Program</span></td>
                                    <td>David Kim</td>
                                    <td><span class="badge bg-info">@L["Medium"]</span></td>
                                    <td>Mar 15, 2026</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-success" style="width: 85%">85%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-success">@L["InProgress"]</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Initiative Timeline -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-calendar-week"></i> @L["InitiativeTimeline"]</h5>
                </div>
                <div class="card-body">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Initiative Modal -->
<div class="modal fade" id="addInitiativeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">@L["AddNewInitiative"]</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form asp-action="CreateInitiative" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">@L["InitiativeName"] *</label>
                        <input type="text" class="form-control" name="Name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">@L["Description"]</label>
                        <textarea class="form-control" name="Description" rows="2"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">@L["Program"] *</label>
                            <select class="form-select" name="ProgramId" required>
                                <option value="">@L["SelectProgram"]</option>
                                <option value="1">ISO 27001 Certification</option>
                                <option value="2">Risk Management Enhancement</option>
                                <option value="3">Compliance Automation</option>
                                <option value="4">Business Continuity</option>
                                <option value="5">Maturity Excellence</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">@L["Owner"] *</label>
                            <input type="text" class="form-control" name="Owner" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">@L["Priority"] *</label>
                            <select class="form-select" name="Priority" required>
                                <option value="Critical">@L["Critical"]</option>
                                <option value="High">@L["High"]</option>
                                <option value="Medium" selected>@L["Medium"]</option>
                                <option value="Low">@L["Low"]</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">@L["StartDate"] *</label>
                            <input type="date" class="form-control" name="StartDate" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">@L["DueDate"]</label>
                            <input type="date" class="form-control" name="DueDate">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@L["Cancel"]</button>
                    <button type="submit" class="btn btn-primary">@L["AddInitiative"]</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Timeline Chart
        const ctx = document.getElementById('timelineChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Initiatives Starting',
                    data: [5, 3, 4, 2, 3, 4],
                    backgroundColor: 'rgba(54, 162, 235, 0.8)',
                    borderColor: 'rgb(54, 162, 235)',
                    borderWidth: 1
                }, {
                    label: 'Initiatives Completing',
                    data: [2, 3, 4, 5, 3, 4],
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgb(75, 192, 192)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });
    </script>
}
