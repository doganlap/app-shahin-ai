@{
    ViewData["Title"] = "Workflow Inbox";
    var myTasksCount = ViewBag.MyTasksCount ?? 0;
    var approvalsCount = ViewBag.ApprovalsCount ?? 0;
    var escalationsCount = ViewBag.EscalationsCount ?? 0;
    var delegatedCount = ViewBag.DelegatedCount ?? 0;
}

<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h2 mb-2">
                                <i class="fas fa-inbox text-primary me-2"></i>Workflow Inbox
                            </h1>
                            <p class="text-muted mb-0">Track and manage your workflow tasks and approvals</p>
                        </div>
                        <div>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newWorkflowModal">
                                <i class="fas fa-plus me-2"></i>New Workflow
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="row mb-4">
        <div class="col-12">
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" href="#myTasks" data-bs-toggle="tab">
                        <i class="fas fa-tasks me-2"></i>My Tasks
                        @if (myTasksCount > 0) { <span class="badge bg-primary ms-2">@myTasksCount</span> }
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#approvals" data-bs-toggle="tab">
                        <i class="fas fa-check-circle me-2"></i>Approvals
                        @if (approvalsCount > 0) { <span class="badge bg-warning ms-2">@approvalsCount</span> }
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#escalations" data-bs-toggle="tab">
                        <i class="fas fa-fire me-2"></i>Escalations
                        @if (escalationsCount > 0) { <span class="badge bg-danger ms-2">@escalationsCount</span> }
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#delegated" data-bs-toggle="tab">
                        <i class="fas fa-share-alt me-2"></i>Delegated
                        @if (delegatedCount > 0) { <span class="badge bg-info ms-2">@delegatedCount</span> }
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#completed" data-bs-toggle="tab">
                        <i class="fas fa-check me-2"></i>Completed
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Tab Contents -->
    <div class="tab-content">
        <!-- My Tasks Tab -->
        <div class="tab-pane fade show active" id="myTasks">
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Task</th>
                                        <th>Workflow</th>
                                        <th>Status</th>
                                        <th>Due Date</th>
                                        <th>Priority</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Define Scope</strong></td>
                                        <td>WF-001: NCA Assessment</td>
                                        <td><span class="badge bg-warning">In Progress</span></td>
                                        <td>2025-01-08</td>
                                        <td><span class="badge bg-danger">High</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary">Continue</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Asset Identification</strong></td>
                                        <td>WF-002: SAMA Assessment</td>
                                        <td><span class="badge bg-primary">Pending</span></td>
                                        <td>2025-01-10</td>
                                        <td><span class="badge bg-warning">Normal</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary">Start</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Approvals Tab -->
        <div class="tab-pane fade" id="approvals">
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light border-bottom">
                            <h6 class="mb-0">Pending Approvals</h6>
                        </div>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Policy Review & Approval</h6>
                                    <small class="text-muted">Submitted by John Smith • Level 2/4</small>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-success me-2">Approve</button>
                                    <button class="btn btn-sm btn-outline-danger">Reject</button>
                                </div>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Risk Approval</h6>
                                    <small class="text-muted">Submitted by Jane Doe • Level 1/3</small>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-success me-2">Approve</button>
                                    <button class="btn btn-sm btn-outline-danger">Reject</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Escalations Tab -->
        <div class="tab-pane fade" id="escalations">
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm border-left border-danger">
                        <div class="card-body">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6>Escalation Alert</h6>
                                    <p class="mb-2">Finding Remediation (WF-004) is 24 hours overdue</p>
                                    <small class="text-muted">Escalated to: Director • Action Required</small>
                                </div>
                                <button class="btn btn-sm btn-outline-danger">View Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delegated Tab -->
        <div class="tab-pane fade" id="delegated">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                You have delegated 2 approvals. They will return to you if not completed by the delegate.
            </div>
        </div>

        <!-- Completed Tab -->
        <div class="tab-pane fade" id="completed">
            <div class="alert alert-success">
                <i class="fas fa-check-circle me-2"></i>
                You have completed 45 workflows this month. Great progress!
            </div>
        </div>
    </div>

    <!-- Quick Stats Row -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h6 class="text-muted">Today's Tasks</h6>
                    <p class="h3 mb-0">3</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h6 class="text-muted">This Week</h6>
                    <p class="h3 mb-0">8</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h6 class="text-muted">Completion Rate</h6>
                    <p class="h3 mb-0">92%</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h6 class="text-muted">Avg Turnaround</h6>
                    <p class="h3 mb-0">8h</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Workflow Modal -->
<div class="modal fade" id="newWorkflowModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header border-bottom">
                <h5 class="modal-title">Create New Workflow</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <label class="form-label">Workflow Type</label>
                    <select class="form-select" id="workflowType">
                        <option value="">-- Select Workflow --</option>
                        <option value="wf-001">WF-001: NCA ECC Assessment</option>
                        <option value="wf-002">WF-002: SAMA Cyber Assessment</option>
                        <option value="wf-003">WF-003: Evidence Evaluation</option>
                        <option value="wf-004">WF-004: Finding Remediation</option>
                        <option value="wf-005">WF-005: Policy Review</option>
                        <option value="wf-006">WF-006: Risk Approval</option>
                        <option value="wf-007">WF-007: Compliance Audit</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="form-label">Priority</label>
                    <select class="form-select" id="priority">
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="form-label">Notes</label>
                    <textarea class="form-control" id="notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Create Workflow</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Inbox functionality
        $(function () {
            // Load inbox items
            loadInbox();
        });

        function loadInbox() {
            // Load from API - replace with actual API calls
        }
    </script>
}