@using Microsoft.AspNetCore.Mvc.Localization
@inject IHtmlLocalizer<SharedResource> L
@{
    ViewData["Title"] = "Peer Comparison";
    Layout = "_Layout";

    var tenantId = ViewBag.TenantId as Guid?;
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-people"></i> @L["PeerComparison"]</h2>
            <p class="text-muted">@L["CompareyourGRCPerformanceAgainstSimilarOrganizations"]</p>
        </div>
        <div class="col text-end">
            <a asp-action="Dashboard" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> @L["BackToDashboard"]
            </a>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#selectPeersModal">
                <i class="bi bi-plus-circle"></i> @L["SelectPeers"]
            </button>
        </div>
    </div>

    <!-- Peer Group Selection -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-funnel"></i> @L["PeerGroupCriteria"]</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label small">@L["OrganizationSize"]</label>
                            <select class="form-select form-select-sm">
                                <option>@L["AllSizes"]</option>
                                <option selected>@L["Medium"] (100-500 @L["employees"])</option>
                                <option>@L["Large"] (500-1000 @L["employees"])</option>
                                <option>@L["Enterprise"] (1000+ @L["employees"])</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">@L["Industry"]</label>
                            <select class="form-select form-select-sm">
                                <option>@L["AllIndustries"]</option>
                                <option selected>@L["Financial"]</option>
                                <option>@L["Healthcare"]</option>
                                <option>@L["Technology"]</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">@L["Geography"]</label>
                            <select class="form-select form-select-sm">
                                <option>@L["Global"]</option>
                                <option selected>@L["MiddleEast"]</option>
                                <option>@L["SaudiArabia"]</option>
                                <option>@L["GCC"]</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small">@L["MaturityLevel"]</label>
                            <select class="form-select form-select-sm">
                                <option>@L["AllLevels"]</option>
                                <option>@L["Beginner"] (Level 1-2)</option>
                                <option selected>@L["Intermediate"] (Level 3)</option>
                                <option>@L["Advanced"] (Level 4-5)</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary">
                            <i class="bi bi-search"></i> @L["ApplyFilters"]
                        </button>
                        <button class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise"></i> @L["Reset"]
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Peer Group Summary -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white shadow-sm">
                <div class="card-body text-center">
                    <h6 class="opacity-75">@L["PeerGroupSize"]</h6>
                    <h2 class="mb-0">24</h2>
                    <small>@L["Organizations"]</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white shadow-sm">
                <div class="card-body text-center">
                    <h6 class="opacity-75">@L["YourRanking"]</h6>
                    <h2 class="mb-0">8<small>/24</small></h2>
                    <small>@L["Top33Percentile"]</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white shadow-sm">
                <div class="card-body text-center">
                    <h6 class="opacity-75">@L["PeerAverage"]</h6>
                    <h2 class="mb-0">68%</h2>
                    <small>@L["MaturityScore"]</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark shadow-sm">
                <div class="card-body text-center">
                    <h6>@L["YourScore"]</h6>
                    <h2 class="mb-0">72%</h2>
                    <small class="badge bg-success">+4% @L["AboveAverage"]</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Peer Comparison Charts -->
    <div class="row mb-4">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-graph-up"></i> @L["MaturityScoreDistribution"]</h6>
                </div>
                <div class="card-body">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-radar"></i> @L["DimensionComparison"]</h6>
                </div>
                <div class="card-body">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Peer Rankings Table -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-list-ol"></i> @L["PeerRankings"]</h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>@L["Rank"]</th>
                                    <th>@L["Organization"]</th>
                                    <th>@L["Size"]</th>
                                    <th>@L["Industry"]</th>
                                    <th>@L["MaturityScore"]</th>
                                    <th>@L["Certifications"]</th>
                                    <th>@L["Trend"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge bg-warning text-dark">1</span></td>
                                    <td><i class="bi bi-building"></i> Peer Organization A</td>
                                    <td>Medium (250)</td>
                                    <td>Financial</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-success" style="width: 92%">92%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-success">5</span></td>
                                    <td><i class="bi bi-arrow-up text-success"></i> +5%</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-secondary">2</span></td>
                                    <td><i class="bi bi-building"></i> Peer Organization B</td>
                                    <td>Medium (320)</td>
                                    <td>Financial</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-success" style="width: 88%">88%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-success">4</span></td>
                                    <td><i class="bi bi-arrow-up text-success"></i> +3%</td>
                                </tr>
                                <tr class="table-primary">
                                    <td><span class="badge bg-primary">8</span></td>
                                    <td><i class="bi bi-building-check"></i> <strong>@L["YourOrganization"]</strong></td>
                                    <td>Medium (280)</td>
                                    <td>Financial</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-info" style="width: 72%">72%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-info">3</span></td>
                                    <td><i class="bi bi-arrow-up text-success"></i> +2%</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-light text-dark">15</span></td>
                                    <td><i class="bi bi-building"></i> Peer Organization C</td>
                                    <td>Medium (190)</td>
                                    <td>Financial</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-warning" style="width: 58%">58%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-warning text-dark">2</span></td>
                                    <td><i class="bi bi-dash text-muted"></i> 0%</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-light text-dark">24</span></td>
                                    <td><i class="bi bi-building"></i> Peer Organization D</td>
                                    <td>Medium (150)</td>
                                    <td>Financial</td>
                                    <td>
                                        <div class="progress" style="width: 100px; height: 20px;">
                                            <div class="progress-bar bg-danger" style="width: 42%">42%</div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-secondary">1</span></td>
                                    <td><i class="bi bi-arrow-down text-danger"></i> -2%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Insights -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-lightbulb"></i> @L["KeyInsightsFromPeerComparison"]</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-success"><i class="bi bi-check-circle"></i> @L["Strengths"]</h6>
                            <ul>
                                <li>@L["GovernanceScoreAbovePeerAverage"] (+12%)</li>
                                <li>@L["ResilienceProgramsWellEstablished"] (+8%)</li>
                                <li>@L["RiskManagementProcessesMature"] (+5%)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-warning"><i class="bi bi-exclamation-triangle"></i> @L["AreasForImprovement"]</h6>
                            <ul>
                                <li>@L["ExcellenceProgramsLaggingBehindPeers"] (-15%)</li>
                                <li>@L["CertificationCoverageBelowAverage"] (-2 certs)</li>
                                <li>@L["SustainabilityInitiativesBehindLeaders"] (-8%)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Select Peers Modal -->
<div class="modal fade" id="selectPeersModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">@L["SelectPeerOrganizations"]</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">@L["SelectUpTo10OrganizationsForDetailedComparison"]</p>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="peer1">
                    <label class="form-check-label" for="peer1">
                        <strong>Organization A</strong> - Financial Services (250 employees) - 92% maturity
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="peer2">
                    <label class="form-check-label" for="peer2">
                        <strong>Organization B</strong> - Financial Services (320 employees) - 88% maturity
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="peer3">
                    <label class="form-check-label" for="peer3">
                        <strong>Organization C</strong> - Financial Services (190 employees) - 58% maturity
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@L["Cancel"]</button>
                <button type="button" class="btn btn-primary">@L["ApplySelection"]</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Distribution Chart
        const distCtx = document.getElementById('distributionChart').getContext('2d');
        new Chart(distCtx, {
            type: 'bar',
            data: {
                labels: ['0-20%', '21-40%', '41-60%', '61-80%', '81-100%'],
                datasets: [{
                    label: 'Number of Peers',
                    data: [1, 2, 8, 10, 3],
                    backgroundColor: [
                        'rgba(220, 53, 69, 0.8)',
                        'rgba(253, 126, 20, 0.8)',
                        'rgba(255, 193, 7, 0.8)',
                        'rgba(13, 202, 240, 0.8)',
                        'rgba(25, 135, 84, 0.8)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    annotation: {
                        annotations: {
                            yourScore: {
                                type: 'line',
                                xMin: 3.2,
                                xMax: 3.2,
                                borderColor: 'rgb(54, 162, 235)',
                                borderWidth: 2,
                                label: {
                                    enabled: true,
                                    content: 'Your Score (72%)'
                                }
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 2 }
                    }
                }
            }
        });

        // Radar Chart
        const radarCtx = document.getElementById('radarChart').getContext('2d');
        new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: ['Governance', 'Risk', 'Compliance', 'Resilience', 'Excellence', 'Sustainability'],
                datasets: [{
                    label: 'Your Organization',
                    data: [85, 72, 68, 78, 58, 65],
                    borderColor: 'rgb(54, 162, 235)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderWidth: 2
                }, {
                    label: 'Peer Average',
                    data: [73, 70, 70, 70, 73, 73],
                    borderColor: 'rgb(255, 206, 86)',
                    backgroundColor: 'rgba(255, 206, 86, 0.2)',
                    borderWidth: 2,
                    borderDash: [5, 5]
                }, {
                    label: 'Top Peer',
                    data: [95, 92, 90, 88, 92, 90],
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    borderWidth: 1,
                    borderDash: [10, 5]
                }]
            },
            options: {
                responsive: true,
                scales: {
                    r: {
                        min: 0,
                        max: 100,
                        ticks: { stepSize: 20 }
                    }
                }
            }
        });
    </script>
}
