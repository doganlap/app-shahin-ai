@{
    ViewData["Title"] = "Frequently Asked Questions";
    var currentCulture = Context.Request.Cookies["GrcMvc.Culture"] ?? "ar";
    var isRtl = currentCulture == "ar";
    var searchTerm = ViewData["SearchTerm"] as string;
}

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-controller="Help" asp-action="Index">@(isRtl ? "مركز المساعدة" : "Help Center")</a></li>
                    <li class="breadcrumb-item active" aria-current="page">@(isRtl ? "الأسئلة الشائعة" : "FAQ")</li>
                </ol>
            </nav>

            <h1 class="mb-4">
                <i class="bi bi-question-circle text-success me-2"></i>
                @(isRtl ? "الأسئلة الشائعة" : "Frequently Asked Questions")
            </h1>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="row mb-4">
        <div class="col-md-8 offset-md-2">
            <div class="input-group input-group-lg">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" id="faqSearch" class="form-control" 
                       placeholder="@(isRtl ? "ابحث في الأسئلة الشائعة..." : "Search FAQ...")"
                       value="@searchTerm">
                <button class="btn btn-success" onclick="searchFAQ()">
                    @(isRtl ? "بحث" : "Search")
                </button>
            </div>
        </div>
    </div>

    <!-- FAQ Categories -->
    <div class="row">
        <div class="col-lg-9">
            <div id="faqResults">
                <!-- FAQ items will be loaded here -->
                <div class="card mb-3">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">@(isRtl ? "البدء" : "Getting Started")</h5>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="accordionGettingStarted">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                        @(isRtl ? "كيف أبدأ في استخدام النظام؟" : "How do I start using the GRC system?")
                                    </button>
                                </h2>
                                <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#accordionGettingStarted">
                                    <div class="accordion-body">
                                        @(isRtl ? "ابدأ بإكمال معالج الإعداد المكون من 12 خطوة. سيرشدك هذا خلال إعداد المنظمة واختيار الأطر التنظيمية وتخطيط الامتثال الأولي. العملية تستغرق حوالي 15-20 دقيقة." : "Start by completing the 12-step onboarding wizard. This will guide you through organization setup, framework selection, and initial compliance planning. The process takes approximately 15-20 minutes.")
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                        @(isRtl ? "ما هو معالج الإعداد؟" : "What is the onboarding wizard?")
                                    </button>
                                </h2>
                                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#accordionGettingStarted">
                                    <div class="accordion-body">
                                        @(isRtl ? "معالج الإعداد هو عملية مكونة من 12 خطوة (الخطوات A-L) تساعدك في تكوين ملف المنظمة واختيار الأطر التنظيمية المناسبة وإنشاء خطة الامتثال الأولى." : "The onboarding wizard is a 12-step process (Steps A-L) that helps you configure your organization profile, select applicable regulatory frameworks, and create your first compliance plan.")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">@(isRtl ? "الأطر التنظيمية" : "Regulatory Frameworks")</h5>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="accordionFrameworks">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                        @(isRtl ? "ما هو NCA ECC؟" : "What is NCA ECC?")
                                    </button>
                                </h2>
                                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#accordionFrameworks">
                                    <div class="accordion-body">
                                        @(isRtl ? "NCA ECC (ضوابط الأمن السيبراني الأساسية للهيئة الوطنية للأمن السيبراني) هو إطار الأمن السيبراني الإلزامي في المملكة العربية السعودية لجميع المنظمات العاملة في المملكة." : "NCA ECC (National Cybersecurity Authority Essential Cybersecurity Controls) is Saudi Arabia's mandatory cybersecurity framework for all organizations operating in the Kingdom.")
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                        @(isRtl ? "ما هو SAMA CSF؟" : "What is SAMA CSF?")
                                    </button>
                                </h2>
                                <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#accordionFrameworks">
                                    <div class="accordion-body">
                                        @(isRtl ? "SAMA CSF (إطار الأمن السيبراني للهيئة النقدية السعودية) هو إطار الأمن السيبراني المخصص للمؤسسات المالية التي تنظمها الهيئة النقدية السعودية." : "SAMA CSF (Saudi Arabian Monetary Authority Cyber Security Framework) is the cybersecurity framework specifically for financial institutions regulated by SAMA.")
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                        @(isRtl ? "ما هو PDPL؟" : "What is PDPL?")
                                    </button>
                                </h2>
                                <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#accordionFrameworks">
                                    <div class="accordion-body">
                                        @(isRtl ? "PDPL (قانون حماية البيانات الشخصية) هو نظام حماية البيانات في المملكة العربية السعودية الذي يحكم كيفية جمع ومعالجة وحماية البيانات الشخصية." : "PDPL (Personal Data Protection Law) is Saudi Arabia's data protection regulation that governs how personal data must be collected, processed, and protected.")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-3">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        @(isRtl ? "لم تجد إجابتك؟" : "Can't find your answer?")
                    </h5>
                </div>
                <div class="card-body">
                    <p>@(isRtl ? "إذا لم تجد إجابة لسؤالك، يمكنك:" : "If you can't find an answer to your question, you can:")</p>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a asp-action="Contact" class="btn btn-primary btn-sm w-100">
                                <i class="bi bi-envelope me-1"></i>
                                @(isRtl ? "اتصل بالدعم" : "Contact Support")
                            </a>
                        </li>
                        <li>
                            <a asp-action="GettingStarted" class="btn btn-outline-primary btn-sm w-100">
                                <i class="bi bi-rocket me-1"></i>
                                @(isRtl ? "دليل البدء" : "Getting Started")
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function searchFAQ() {
        const query = document.getElementById('faqSearch').value;
        if (!query) return;

        fetch(`/Help/SearchFAQ?query=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                displayFAQResults(data);
            })
            .catch(error => {
                console.error('Error searching FAQ:', error);
            });
    }

    function displayFAQResults(results) {
        const container = document.getElementById('faqResults');
        // Implementation for displaying search results
    }

    // Auto-search on Enter key
    document.getElementById('faqSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchFAQ();
        }
    });
</script>
