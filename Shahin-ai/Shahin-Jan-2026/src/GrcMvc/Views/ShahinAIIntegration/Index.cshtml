@model GrcMvc.Controllers.IntegratedFlowViewModel
@{
    ViewData["Title"] = "Shahin-AI Integrated Flow";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h2 mb-1">
                <i class="fas fa-project-diagram text-primary me-2"></i>
                Shahin-AI Integrated GRC Flow
            </h1>
            <p class="text-muted">Complete process: Onboarding → Assessment → Workflow → Evidence</p>
        </div>
    </div>

    <!-- Flow Diagram -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <!-- Step 1: Onboarding -->
                        <div class="text-center p-3">
                            <div class="rounded-circle bg-@(Model.OnboardingComplete ? "success" : "secondary") bg-opacity-10 p-4 mx-auto mb-2" style="width: 80px; height: 80px;">
                                <i class="fas fa-clipboard-list fa-2x text-@(Model.OnboardingComplete ? "success" : "secondary")"></i>
                            </div>
                            <h6>1. Onboarding</h6>
                            <span class="badge bg-@(Model.OnboardingComplete ? "success" : "warning")">
                                @(Model.OnboardingComplete ? "Complete" : "Pending")
                            </span>
                        </div>

                        <i class="fas fa-arrow-right fa-2x text-muted d-none d-md-block"></i>

                        <!-- Step 2: Scope -->
                        <div class="text-center p-3">
                            <div class="rounded-circle bg-primary bg-opacity-10 p-4 mx-auto mb-2" style="width: 80px; height: 80px;">
                                <i class="fas fa-filter fa-2x text-primary"></i>
                            </div>
                            <h6>2. Derived Scope</h6>
                            <span class="badge bg-primary">@Model.DerivedBaselines Baselines</span>
                        </div>

                        <i class="fas fa-arrow-right fa-2x text-muted d-none d-md-block"></i>

                        <!-- Step 3: Assessments -->
                        <div class="text-center p-3">
                            <div class="rounded-circle bg-info bg-opacity-10 p-4 mx-auto mb-2" style="width: 80px; height: 80px;">
                                <i class="fas fa-clipboard-check fa-2x text-info"></i>
                            </div>
                            <h6>3. Assessments</h6>
                            <span class="badge bg-info">@Model.TotalAssessments Total</span>
                        </div>

                        <i class="fas fa-arrow-right fa-2x text-muted d-none d-md-block"></i>

                        <!-- Step 4: Workflows -->
                        <div class="text-center p-3">
                            <div class="rounded-circle bg-warning bg-opacity-10 p-4 mx-auto mb-2" style="width: 80px; height: 80px;">
                                <i class="fas fa-tasks fa-2x text-warning"></i>
                            </div>
                            <h6>4. Workflows</h6>
                            <span class="badge bg-warning text-dark">@Model.ActiveWorkflows Active</span>
                        </div>

                        <i class="fas fa-arrow-right fa-2x text-muted d-none d-md-block"></i>

                        <!-- Step 5: Evidence -->
                        <div class="text-center p-3">
                            <div class="rounded-circle bg-success bg-opacity-10 p-4 mx-auto mb-2" style="width: 80px; height: 80px;">
                                <i class="fas fa-file-alt fa-2x text-success"></i>
                            </div>
                            <h6>5. Evidence</h6>
                            <span class="badge bg-success">@Model.ApprovedEvidence/@Model.TotalEvidence</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shahin-AI Module Stats -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="mb-3"><i class="fas fa-shield-alt text-primary me-2"></i>Shahin-AI Module Status</h5>
        </div>

        <!-- MAP -->
        <div class="col-md-2">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="fas fa-map fa-2x text-primary mb-2"></i>
                    <h6>MAP</h6>
                    <div class="h4 mb-0">@Model.TotalControls</div>
                    <small class="text-muted">Controls</small>
                </div>
            </div>
        </div>

        <!-- APPLY -->
        <div class="col-md-2">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                    <h6>APPLY</h6>
                    <div class="h4 mb-0">@Model.DerivedPackages</div>
                    <small class="text-muted">Packages</small>
                </div>
            </div>
        </div>

        <!-- PROVE -->
        <div class="col-md-2">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="fas fa-file-alt fa-2x mb-2" style="color: #9B59B6;"></i>
                    <h6>PROVE</h6>
                    <div class="h4 mb-0">@Model.TotalEvidence</div>
                    <small class="text-muted">Evidence</small>
                </div>
            </div>
        </div>

        <!-- WATCH -->
        <div class="col-md-2">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="fas fa-eye fa-2x text-danger mb-2"></i>
                    <h6>WATCH</h6>
                    <div class="h4 mb-0">@Model.TotalIndicators</div>
                    <small class="text-muted">KRIs</small>
                    @if (Model.OpenAlerts > 0)
                    {
                        <div><span class="badge bg-danger">@Model.OpenAlerts Alerts</span></div>
                    }
                </div>
            </div>
        </div>

        <!-- FIX -->
        <div class="col-md-2">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="fas fa-wrench fa-2x text-warning mb-2"></i>
                    <h6>FIX</h6>
                    <div class="h4 mb-0">@Model.OpenExceptions</div>
                    <small class="text-muted">Exceptions</small>
                </div>
            </div>
        </div>

        <!-- VAULT -->
        <div class="col-md-2">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <i class="fas fa-lock fa-2x mb-2" style="color: #1ABC9C;"></i>
                    <h6>VAULT</h6>
                    <div class="h4 mb-0">@Model.ApprovedEvidence</div>
                    <small class="text-muted">Stored</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Organization Profile & Actions -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent">
                    <i class="fas fa-building me-2"></i>Organization Profile
                </div>
                <div class="card-body">
                    @if (Model.OrganizationProfile != null)
                    {
                        <table class="table table-sm">
                            <tr><th>Type</th><td>@Model.OrganizationProfile.OrganizationType</td></tr>
                            <tr><th>Sector</th><td>@Model.OrganizationProfile.Sector</td></tr>
                            <tr><th>Country</th><td>@Model.OrganizationProfile.Country</td></tr>
                            <tr><th>Maturity</th><td><span class="badge bg-info">@Model.OrganizationProfile.ComplianceMaturity</span></td></tr>
                        </table>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="fas fa-exclamation-circle fa-3x text-warning mb-3"></i>
                            <p>No organization profile found.</p>
                            <a href="/Onboarding" class="btn btn-primary">
                                <i class="fas fa-rocket me-2"></i>Start Onboarding
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent">
                    <i class="fas fa-bolt me-2"></i>Quick Actions
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="/Onboarding" class="btn btn-outline-primary">
                            <i class="fas fa-rocket me-2"></i>Onboarding Wizard
                        </a>
                        <a href="@Url.Action("Assessments")" class="btn btn-outline-info">
                            <i class="fas fa-clipboard-check me-2"></i>View Assessments
                        </a>
                        <a href="@Url.Action("Workflows")" class="btn btn-outline-warning">
                            <i class="fas fa-tasks me-2"></i>View Workflows
                        </a>
                        <a href="/ShahinAI" class="btn btn-outline-success">
                            <i class="fas fa-shield-alt me-2"></i>Shahin-AI Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activities -->
    <div class="row">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent">
                    <i class="fas fa-clipboard-check me-2"></i>Recent Assessments
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Assessment</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var assessment in Model.RecentAssessments)
                                {
                                    <tr>
                                        <td>@assessment.Name</td>
                                        <td><span class="badge bg-@(assessment.Status == "Completed" ? "success" : "info")">@assessment.Status</span></td>
                                        <td>@assessment.CreatedDate.ToString("MMM dd")</td>
                                    </tr>
                                }
                                @if (!Model.RecentAssessments.Any())
                                {
                                    <tr><td colspan="3" class="text-center text-muted py-3">No assessments yet</td></tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent">
                    <i class="fas fa-tasks me-2"></i>Recent Workflows
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Workflow</th>
                                    <th>Status</th>
                                    <th>Started</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var workflow in Model.RecentWorkflows)
                                {
                                    <tr>
                                        <td>@workflow.Id.ToString().Substring(0, 8)</td>
                                        <td><span class="badge bg-@(workflow.Status == "Completed" ? "success" : "warning")">@workflow.Status</span></td>
                                        <td>—</td>
                                    </tr>
                                }
                                @if (!Model.RecentWorkflows.Any())
                                {
                                    <tr><td colspan="3" class="text-center text-muted py-3">No workflows yet</td></tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
