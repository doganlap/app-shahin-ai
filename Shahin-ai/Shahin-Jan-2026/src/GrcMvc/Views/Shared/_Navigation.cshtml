@using GrcMvc.Models.DTOs
@using Microsoft.AspNetCore.Http
@using System.Globalization
@inject IHttpContextAccessor HttpContextAccessor
@inject GrcMvc.Services.Interfaces.ITenantContextService TenantContext
@{
    // Fallback localizer dictionary if SharedLocalizer is not available
    var SharedLocalizer = new Dictionary<string, string>
    {
        ["Home"] = "Home",
        ["Features"] = "Features",
        ["Risk Management"] = "Risk Management",
        ["Compliance"] = "Compliance",
        ["Audit"] = "Audit",
        ["Analytics"] = "Analytics",
        ["Pricing"] = "Pricing",
        ["Resources"] = "Resources",
        ["Documentation"] = "Documentation",
        ["API Reference"] = "API Reference",
        ["Blog"] = "Blog",
        ["Support"] = "Support",
        ["Dashboard"] = "Dashboard",
        ["Workspace"] = "Workspace",
        ["Settings"] = "Settings",
        ["Profile"] = "Profile",
        ["Logout"] = "Logout",
        ["Login"] = "Login",
        ["Start Trial"] = "Start Trial",
        ["Current Tenant"] = "Current Tenant",
        ["Trial"] = "Trial"
    };
}

@{
    var currentTenantId = TenantContext.GetCurrentTenantId();
    var isAuthenticated = User.Identity?.IsAuthenticated ?? false;
    var currentPath = ViewContext.HttpContext.Request.Path.Value ?? "";
    var hasTenant = currentTenantId != Guid.Empty;
}

<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm" id="mainNav">
    <div class="container">
        <!-- Brand -->
        <a class="navbar-brand d-flex align-items-center" href="/">
            <img src="/images/logo-white.png" alt="Shahin AI" class="me-2" style="height: 32px;">
            <span class="fw-bold">Shahin AI GRC</span>
        </a>

        <!-- Mobile toggle -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navigation items -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <!-- Home -->
                <li class="nav-item">
                    <a class="nav-link @(currentPath == "/" ? "active" : "")" href="/">
                        <i class="fas fa-home me-1"></i>
                        @SharedLocalizer["Home"]
                    </a>
                </li>

                <!-- Features -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-star me-1"></i>
                        @SharedLocalizer["Features"]
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/features/risk-management">
                            <i class="fas fa-shield-alt me-2"></i>@SharedLocalizer["Risk Management"]
                        </a></li>
                        <li><a class="dropdown-item" href="/features/compliance">
                            <i class="fas fa-check-circle me-2"></i>@SharedLocalizer["Compliance"]
                        </a></li>
                        <li><a class="dropdown-item" href="/features/audit">
                            <i class="fas fa-clipboard-check me-2"></i>@SharedLocalizer["Audit"]
                        </a></li>
                        <li><a class="dropdown-item" href="/features/analytics">
                            <i class="fas fa-chart-line me-2"></i>@SharedLocalizer["Analytics"]
                        </a></li>
                    </ul>
                </li>

                <!-- Pricing -->
                <li class="nav-item">
                    <a class="nav-link @(currentPath.Contains("/pricing") ? "active" : "")" href="/pricing">
                        <i class="fas fa-tags me-1"></i>
                        @SharedLocalizer["Pricing"]
                    </a>
                </li>

                <!-- Resources -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-book me-1"></i>
                        @SharedLocalizer["Resources"]
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/docs">
                            <i class="fas fa-file-alt me-2"></i>@SharedLocalizer["Documentation"]
                        </a></li>
                        <li><a class="dropdown-item" href="/api">
                            <i class="fas fa-code me-2"></i>@SharedLocalizer["API Reference"]
                        </a></li>
                        <li><a class="dropdown-item" href="/blog">
                            <i class="fas fa-blog me-2"></i>@SharedLocalizer["Blog"]
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/support">
                            <i class="fas fa-headset me-2"></i>@SharedLocalizer["Support"]
                        </a></li>
                    </ul>
                </li>
            </ul>

            <!-- Right side items -->
            <ul class="navbar-nav">
                <!-- Language switcher -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-globe me-1"></i>
                        @(System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar") ? "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" : "English")
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <form asp-controller="Language" asp-action="Set" asp-route-culture="en" method="post" class="d-inline">
                                <button type="submit" class="dropdown-item">
                                    ðŸ‡ºðŸ‡¸ English
                                </button>
                            </form>
                        </li>
                        <li>
                            <form asp-controller="Language" asp-action="Set" asp-route-culture="ar" method="post" class="d-inline">
                                <button type="submit" class="dropdown-item">
                                    ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                                </button>
                            </form>
                        </li>
                    </ul>
                </li>

                @if (isAuthenticated)
                {
                    <!-- User menu -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                            <div class="avatar-sm bg-light rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                                <i class="fas fa-user text-primary"></i>
                            </div>
                            @User.Identity.Name
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            @if (hasTenant)
                            {
                                <li><h6 class="dropdown-header">
                                    <i class="fas fa-building me-1"></i>
                                    Tenant
                                </h6></li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="/dashboard">
                                        <i class="fas fa-tachometer-alt me-2"></i>@SharedLocalizer["Dashboard"]
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/workspace">
                                        <i class="fas fa-briefcase me-2"></i>@SharedLocalizer["Workspace"]
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/settings">
                                        <i class="fas fa-cog me-2"></i>@SharedLocalizer["Settings"]
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                            }
                            else
                            {
                                <li>
                                    <a class="dropdown-item" href="/dashboard">
                                        <i class="fas fa-tachometer-alt me-2"></i>@SharedLocalizer["Dashboard"]
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                            }
                            <li>
                                <a class="dropdown-item" href="/Account/Profile">
                                    <i class="fas fa-user me-2"></i>@SharedLocalizer["Profile"]
                                </a>
                            </li>
                            <li>
                                <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                                    <button type="submit" class="dropdown-item">
                                        <i class="fas fa-sign-out-alt me-2"></i>@SharedLocalizer["Logout"]
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                }
                else
                {
                    <!-- Auth buttons -->
                    <li class="nav-item">
                        <a class="nav-link" href="/Account/Login">
                            <i class="fas fa-sign-in-alt me-1"></i>
                            @SharedLocalizer["Login"]
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-light btn-sm ms-2" href="/trial">
                            <i class="fas fa-rocket me-1"></i>
                            @SharedLocalizer["Start Trial"]
                        </a>
                    </li>
                }
            </ul>
        </div>
    </div>
</nav>

<!-- Tenant indicator (when in tenant context) -->
@if (hasTenant)
{
    <div class="tenant-indicator bg-info text-dark py-2">
        <div class="container">
            <div class="d-flex align-items-center">
                <i class="fas fa-building me-2"></i>
                <strong>@SharedLocalizer["Current Tenant"]:</strong>
                <span class="ms-2">Tenant ID: @currentTenantId</span>
            </div>
        </div>
    </div>
}
