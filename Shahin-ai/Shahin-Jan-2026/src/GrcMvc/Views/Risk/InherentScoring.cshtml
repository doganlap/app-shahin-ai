@using Microsoft.AspNetCore.Mvc.Localization
@using GrcMvc.Configuration
@inject IHtmlLocalizer<SharedResource> L
@model GrcMvc.Models.DTOs.RiskDto
@{
    ViewData["Title"] = "Inherent Risk Scoring";
    Layout = "_Layout";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-calculator"></i> Inherent Risk Scoring</h2>
            <p class="text-muted">Assess inherent risk before controls are applied</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Risk: @Model.Name</h5>
                </div>
                <div class="card-body">
                    <form asp-action="CalculateInherentRisk" method="post">
                        <input type="hidden" name="riskId" value="@Model.Id" />
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Probability (Likelihood)</label>
                                <select name="probability" class="form-select" required>
                                    <option value="1" selected="@(Model.Probability == 1)">1 - Rare</option>
                                    <option value="2" selected="@(Model.Probability == 2)">2 - Unlikely</option>
                                    <option value="3" selected="@(Model.Probability == 3)">3 - Possible</option>
                                    <option value="4" selected="@(Model.Probability == 4)">4 - Likely</option>
                                    <option value="5" selected="@(Model.Probability == 5)">5 - Almost Certain</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Impact (Severity)</label>
                                <select name="impact" class="form-select" required>
                                    <option value="1" selected="@(Model.Impact == 1)">1 - Negligible</option>
                                    <option value="2" selected="@(Model.Impact == 2)">2 - Minor</option>
                                    <option value="3" selected="@(Model.Impact == 3)">3 - Moderate</option>
                                    <option value="4" selected="@(Model.Impact == 4)">4 - Major</option>
                                    <option value="5" selected="@(Model.Impact == 5)">5 - Catastrophic</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Risk Score</label>
                            <div class="alert alert-info">
                                <h4 id="riskScore">@(Model.Probability * Model.Impact)</h4>
                                <small>Inherent Risk = Probability Ã— Impact</small>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Risk Level</label>
                            <div id="riskLevel" class="badge bg-secondary fs-6">
                                @{
                                    var score = Model.Probability * Model.Impact;
                                    var level = score >= 20 ? "Critical" : score >= 12 ? "High" : score >= 6 ? "Medium" : "Low";
                                }
                                @level
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Save Inherent Risk Score
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6>Risk Matrix Guide</h6>
                </div>
                <div class="card-body">
                    <table class="table table-bordered table-sm">
                        <thead>
                            <tr>
                                <th>Score</th>
                                <th>Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-danger">
                                <td>20-25</td>
                                <td>Critical</td>
                            </tr>
                            <tr class="table-warning">
                                <td>12-19</td>
                                <td>High</td>
                            </tr>
                            <tr class="table-info">
                                <td>6-11</td>
                                <td>Medium</td>
                            </tr>
                            <tr class="table-success">
                                <td>1-5</td>
                                <td>Low</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const probSelect = document.querySelector('select[name="probability"]');
        const impactSelect = document.querySelector('select[name="impact"]');
        const scoreDiv = document.getElementById('riskScore');
        const levelDiv = document.getElementById('riskLevel');
        
        function updateScore() {
            const prob = parseInt(probSelect.value) || 1;
            const impact = parseInt(impactSelect.value) || 1;
            const score = prob * impact;
            
            scoreDiv.textContent = score;
            
            let level = 'Low', className = 'bg-success';
            if (score >= 20) { level = 'Critical'; className = 'bg-danger'; }
            else if (score >= 12) { level = 'High'; className = 'bg-warning'; }
            else if (score >= 6) { level = 'Medium'; className = 'bg-info'; }
            
            levelDiv.textContent = level;
            levelDiv.className = 'badge ' + className + ' fs-6';
        }
        
        probSelect.addEventListener('change', updateScore);
        impactSelect.addEventListener('change', updateScore);
    });
</script>