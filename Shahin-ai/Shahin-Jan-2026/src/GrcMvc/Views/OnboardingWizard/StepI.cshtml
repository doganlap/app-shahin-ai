@model StepIWorkflowCadenceDto
@using GrcMvc.Models.DTOs
@{
    ViewData["Title"] = "Workflow & Cadence - Onboarding Wizard";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var summary = ViewData["WizardSummary"] as WizardSummaryDto;
    var tenantId = summary?.TenantId ?? Guid.Empty;
}

<div class="d-flex">
    @await Html.PartialAsync("_WizardSidebar", summary)

    <div class="flex-grow-1 p-4">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-project-diagram text-primary me-2"></i>
                        Step I: Workflow & Cadence
                    </h2>
                    <p class="text-muted mb-0">سير العمل والتكرار | Questions 71-80 • Make it "non-forgettable"</p>
                </div>
                <span class="badge bg-primary fs-6">Step 9 of 12</span>
            </div>

            <form asp-action="StepI" asp-route-tenantId="@tenantId" method="post">
                @Html.AntiForgeryToken()

                <!-- Review Frequencies -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-sync me-2"></i>Review Frequencies (Q72-76)</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label asp-for="AccessReviewsFrequency" class="form-label">Access Reviews</label>
                                <select asp-for="AccessReviewsFrequency" class="form-select">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="semiannual">Semi-Annual</option>
                                    <option value="annual">Annual</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="VulnerabilityPatchReviewFrequency" class="form-label">Vulnerability/Patch Review</label>
                                <select asp-for="VulnerabilityPatchReviewFrequency" class="form-select">
                                    <option value="weekly">Weekly</option>
                                    <option value="biweekly">Bi-Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="BackupReviewFrequency" class="form-label">Backup Review</label>
                                <select asp-for="BackupReviewFrequency" class="form-select">
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label asp-for="RestoreTestCadence" class="form-label">Restore Test</label>
                                <select asp-for="RestoreTestCadence" class="form-select">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="semiannual">Semi-Annual</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="DrExerciseCadence" class="form-label">DR Exercise</label>
                                <select asp-for="DrExerciseCadence" class="form-select">
                                    <option value="quarterly">Quarterly</option>
                                    <option value="semiannual">Semi-Annual</option>
                                    <option value="annual">Annual</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="IncidentTabletopCadence" class="form-label">Incident Tabletop</label>
                                <select asp-for="IncidentTabletopCadence" class="form-select">
                                    <option value="quarterly">Quarterly</option>
                                    <option value="semiannual">Semi-Annual</option>
                                    <option value="annual">Annual</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SLA Configuration -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-clock me-2"></i>SLA Configuration (Q77-79)</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label asp-for="EvidenceSlaSubmitDays" class="form-label">Evidence SLA (Days)</label>
                                <input type="number" asp-for="EvidenceSlaSubmitDays" class="form-control" min="1" max="30">
                                <small class="text-muted">Submit within X days of due date</small>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="ExceptionExpiryDays" class="form-label">Exception Expiry (Days)</label>
                                <input type="number" asp-for="ExceptionExpiryDays" class="form-control" min="30" max="365">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="AuditRequestHandling" class="form-label">Audit Request Queue</label>
                                <select asp-for="AuditRequestHandling" class="form-select">
                                    <option value="single_queue">Single Queue</option>
                                    <option value="per_domain_queue">Per Domain Queue</option>
                                </select>
                            </div>
                        </div>

                        <h6 class="mt-3 mb-2">Remediation SLA by Severity (Days)</h6>
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <label class="form-label small text-danger">Critical</label>
                                <input type="number" name="RemediationSla[critical]" class="form-control" 
                                       value="@(Model.RemediationSla.GetValueOrDefault("critical", 7))" min="1" max="30">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label small text-warning">High</label>
                                <input type="number" name="RemediationSla[high]" class="form-control" 
                                       value="@(Model.RemediationSla.GetValueOrDefault("high", 14))" min="1" max="60">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label small text-info">Medium</label>
                                <input type="number" name="RemediationSla[medium]" class="form-control" 
                                       value="@(Model.RemediationSla.GetValueOrDefault("medium", 30))" min="1" max="90">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label small text-secondary">Low</label>
                                <input type="number" name="RemediationSla[low]" class="form-control" 
                                       value="@(Model.RemediationSla.GetValueOrDefault("low", 60))" min="1" max="180">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a href="@Url.Action("StepH", new { tenantId })" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i> Back
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg">
                        Continue to Step J <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
